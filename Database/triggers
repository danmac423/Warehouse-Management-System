CREATE OR REPLACE unpacked_function()
	RETURNS TRIGGER
AS
$$
	BEGIN
	-- logowanie supplies
		INSERT INTO NAZWA_HISTORII_DOSTAW

	-- logowanie products_supply: dla logguje do posredniej tabeli kolejne rzedy i dodaje do stanu magazynu
		FOR r in SELECT * FROM supplies_products WHERE supply_id = argument
		LOOP
			-- dodaj do stanu magazynu
			
			-- archiwizuj rzÄ…d
			INSERT INTO supplies_products_history (supply_id, product_id, amount)
			VALUES (r.supply_id, r.product_id, r.amount);
		END LOOP;
	
	RETURN NEW;
END;
$$ LANGUAGE plsql;

CREATE OR REPLACE TRIGGER unpacked_supply
AFTER UPDATE OF supplies.state on supplies
FOR EACH STATEMENT 
EXECUTE FUNCTION unpacked_function();